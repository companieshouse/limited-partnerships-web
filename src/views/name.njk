{% extends "layout.njk" %}

{% block content %}

{% set partnershipType = props.parameters['which-type'] %}

{% if partnershipType == "registerLp" %}
  {% set title = i18n.namePage.title %}
  {% set whatIsName = i18n.namePage.whatIsName %}
  {% set nameEnding = i18n.namePage.nameEnding %}
{% elif partnershipType == "registerPflp" %}
  {% set title = i18n.namePage.privateFund.title %}
  {% set whatIsName = i18n.namePage.privateFund.whatIsName %}
  {% set nameEnding = i18n.namePage.privateFund.nameEnding %}
{% elif partnershipType == "registerSlp" %}
  {% set title = i18n.namePage.scottish.title %}
  {% set whatIsName = i18n.namePage.scottish.whatIsName %}
  {% set nameEnding = i18n.namePage.scottish.nameEnding %}
{% elif partnershipType == "registerPflpSco" %}
  {% set title = i18n.namePage.privateFund.scottish.title %}
  {% set whatIsName = i18n.namePage.privateFund.scottish.whatIsName %}
  {% set nameEnding = i18n.namePage.privateFund.nameEnding %}
{% endif %}


<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <form class="form" action={{ props.currentUrl }} method="post">
      <input type="hidden" name="pageType" value={{ props.pageType }}>
      
      {% include "includes/csrf_token.njk" %}

      <h1 class="govuk-heading-xl">{{ title }}</h1>

      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--l" for="partnership_name">
            {{ whatIsName }}
          </label>
        </h1>

        {{ govukInput ({
          classes: "govuk-input--width-40",
          errorMessage: props.errors.partnership_name if errors,
          id: "partnership_name",
          name: "partnership_name",
          value: props.data.limitedPartnership.partnership_name,
          fieldset: {
            legend: {
              isPageHeading: false,
              classes: "govuk-fieldset__legend--xl"
            }
          },
          hint: {
            text: i18n.namePage.whatIsNameHint
          },
          attributes : {
            required : true,
            "aria-describedby": "partnership_name-hint",
            minLength: "1"
          },
          suffix: {
            text: "Limited Partnership"
          }
        }) }}

      </div>

      {{ govukInsetText({
        html: '<p>' + i18n.namePage.existingPartnershipHint + '</p><p>' + i18n.namePage.sensitiveWordHint + '</p><p>' + i18n.namePage.existingTrademarkHint + '</p>'
      }) }}

      <div class="govuk-form-group">
        <fieldset class="govuk-fieldset" aria-describedby="nameEnding-hint">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
            <h1 class="govuk-fieldset__heading">
              {{ nameEnding }}
            </h1>
          </legend>

          {% include "pages/name/options-with-or-without-welsh.njk" %}

        </fieldset>
      </div>

      {% include "includes/save-and-continue-button.njk" %}
    </form>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    function validateNameLength() {
      const name = nameField.value + " " + suffixDiv.textContent;
      const maxLength = 160;
      if (name.length > maxLength){
        nameField.setCustomValidity(`Max length including suffix is ${maxLength} characters`);
      } else {
        nameField.setCustomValidity('');
      }
      nameField.reportValidity();
    };

    const suffixDiv = document.querySelector('.govuk-input__suffix');
    const radioButtons = document.querySelectorAll('input[name="name_ending"]');

    radioButtons.forEach(function(radioButton) {
      radioButton.addEventListener('change', function() {
        if (radioButton.checked) {
          suffixDiv.textContent = radioButton.value;
          validateNameLength();
        }
      });
    });

    const nameField = document.getElementById('partnership_name');
    nameField.addEventListener('keyup', validateNameLength);

    const form = document.querySelector('.form');

    form.addEventListener('submit', function(evt) {
      if (!suffixDiv.textContent) {
        evt.preventDefault();
      }
      nameField.value = nameField.value.trim();
    });
  });
</script>

{% endblock %}
